"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.reLaunch=exports.navigateBack=exports.switchTab=exports.redirectTo=exports.navigateTo=exports.getUrlQueryString=exports.getQueryString=exports.getCurrentPageUrlWithArgs=exports.getCurrentPageUrl=exports.getCurrentPage=exports.appendUrlParameter=exports.removeQueryString=exports.modifyQueryString=exports.normalize=exports.getSerializedUrl=exports.toQueryString=exports.parseParamToObj=exports.parseUrlParamToObj=exports.getURLSearchParamStr=exports.isHttpUrl=void 0;var _wxPromisify=require("./wxPromisify.js"),_lodash=require("../npm/lodash/lodash.js"),_index=require("../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index);function _interopRequireDefault(r){return r&&r.__esModule?r:{default:r}}function _defineProperty(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}var isHttpUrl=exports.isHttpUrl=function(r){return r&&(0===r.indexOf("//")||new RegExp("(https|http|ftp)?://").test(r))},getURLSearchParamStr=exports.getURLSearchParamStr=function(r){if(!r)return"";var e=r.split("?")[1]||"";return e?e.replace(/#\/.*/,""):""},parseUrlParamToObj=exports.parseUrlParamToObj=function(r){var e=getURLSearchParamStr(r);return e?e.split("&").reduce(function(r,e){var t=e.indexOf("="),n=(-1!==t?[e.substr(0,t),e.substr(t+1)]:[e]).map(function(r){return decodeURIComponent(r.replace("+"," "))});return r[n[0]]=n[1],r},{}):{}},parseParamToObj=exports.parseParamToObj=function(r){return-1===r.indexOf("?")?parseUrlParamToObj("?"+r):parseUrlParamToObj(r)},toQueryString=exports.toQueryString=function(r){var e=[];for(var t in r)if(r.hasOwnProperty(t)){var n=r[t];n?e.push(encodeURIComponent(t)+"="+encodeURIComponent(n)):e.push(encodeURIComponent(t)+"=")}return e.join("&")},getSerializedUrl=exports.getSerializedUrl=function(r,e){var t=toQueryString(e);return t?r.split("?")[0]+"?"+t:r.split("?")[0]},normalize=exports.normalize=function(r){for(var e=arguments.length,t=Array(1<e?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];var a=r&&r.split("?")[1]||"",o=r?r.split("?")[0]:"";isHttpUrl(o)?o=o.replace(/\/*$/,"/"):o&&(t.unshift(o),o="");var i=[];t.forEach(function(r){var e=r?r.replace(/^\/+|\/+$/gi,""):"";e&&i.push(e)});var u=o+i.join("/").replace(/\/{2,}/gi,"/");return a?u+"?"+a:u},modifyQueryString=exports.modifyQueryString=function(r,e){var t=parseUrlParamToObj(r=r||""),n=r.match(/#\/.*/);for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a]);var o=r.split("?")[0];return(toQueryString(t)?o+"?"+toQueryString(t):""+o)+(n?n[0]:"")},removeQueryString=exports.removeQueryString=function(r,e){var t=parseUrlParamToObj(r=r||""),n=r.match(/#\/.*/);delete t[e];var a=r.split("?")[0];return(toQueryString(t)?a+"?"+toQueryString(t):""+a)+(n?n[0]:"")},appendUrlParameter=exports.appendUrlParameter=function(r,e,t){return modifyQueryString(t,_defineProperty({},r,e))},getCurrentPage=exports.getCurrentPage=function(){var r=_index2.default.getCurrentPages();return r.length?r[r.length-1]:{}},getCurrentPageUrl=exports.getCurrentPageUrl=function(){return getCurrentPage().route},getCurrentPageUrlWithArgs=exports.getCurrentPageUrlWithArgs=function(){var r=getCurrentPage(),e=r.route,t=r.options;return getSerializedUrl(e,t)},getQueryString=exports.getQueryString=function(r){var e=getCurrentPage().options;return e&&e[r]?decodeURIComponent(e[r]):void 0},getUrlQueryString=exports.getUrlQueryString=function(r,e){return parseParamToObj(e)[r]},wxNativator=function(e,t,r){var n=getQueryString("env")||_index2.default.getStorageSync("env")||"prod",a=getQueryString("media")||"index";return t=(0,_lodash.extend)(!0,{env:n,media:a},t),Object.keys(t).forEach(function(r){e=appendUrlParameter(r,t[r],e)}),(0,_wxPromisify.wxPromisify)(r,{url:e})},navigateTo=exports.navigateTo=function(r,e){return wxNativator(r,1<arguments.length&&void 0!==e?e:{},"navigateTo")},redirectTo=exports.redirectTo=function(r,e){return wxNativator(r,1<arguments.length&&void 0!==e?e:{},"redirectTo")},switchTab=exports.switchTab=function(r){var e=getUrlQueryString("env",r);return e&&_index2.default.setStorageSync("env",e),wxNativator(r,{},"switchTab")},navigateBack=exports.navigateBack=function(r){_index2.default.navigateBack(r)},reLaunch=exports.reLaunch=function(r,e){return wxNativator(r,1<arguments.length&&void 0!==e?e:{},"reLaunch")};